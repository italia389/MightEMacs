# .memacs	Ver. 9.1.0
#	MightEMacs user startup file.

# Pop or open file whose pathname is at point.
macro openBufPath(0) {desc: 'Get pathname at point (or from region if n <= 0) and display the file in a pop-up window (or open\
 it with ~bfindFile~0 if n >= 0).  Pathname at point is assumed to be bounded by white space or line breaks.'}
	if ($0 <= 0 && $0 != defn)
		path = $RegionText
	else
		# Do sanity checks.
		while $lineChar == ?\s || $lineChar == ?\t
			forwChar
		endloop
		if $lineChar == ?\n
			return 0 => message(nil,'Pathname not found')
		else
			# Find beginning and end of pathname.
			oldMsgState = -1 => chgGlobalMode 'RtnMsg'
			wordChars = $wordChars
			$wordChars = '!-~'
			1 => setMark ??
			backWord
			setMark
			endWord
			path = $RegionText
			-1 => gotoMark ??
			$wordChars = wordChars
			oldMsgState => chgGlobalMode 'RtnMsg'
		endif
	endif

	if !empty?(path = prompt($0 >= 0 ? 'Find file' : 'Pop file',path,'f'))
		if $0 >= 0
			findFile path
		else
			1 => popFile path,'a'
		endif
	endif
endmacro

# Pop a list of all buffers.
macro popBufAll(0) {desc: 'Display all buffers in a pop-up window.'}
	oldMsgState = -1 => chgGlobalMode('RtnMsg')
	bufName = (0 => showBuffers)[0]
	1 => popBuf bufName,'d'
	oldMsgState => chgGlobalMode 'RtnMsg'
endmacro

# Put current keyboard macro into a scratch buffer so it can be edited.
macro editKeyMacro(0) {desc: 'Edit current keyboard macro.'}
	scratchBuf
	insert "# Edit next line, then enter \"C-x x\" to execute this buffer and set the new macro contents.\n\
$keyMacro = '",$keyMacro,"'"
	beginLine
endmacro

bindKey 'ESC E',editKeyMacro
bindKey 'C-x o',openBufPath
bindKey 'C-h B',popBufAll
